#!/bin/bash
#
# This will allow you to search more than 10,000 domains at a time 
# Example: Searching for "Google LLC" in DRS returns over 10K domains.

URL="https://reverse-whois.whoisxmlapi.com/api/v2"

searchAfter=0
request_template="template.json"
request_current="request.json"
result_current="result.json"
all_results="all_results.csv"


cat "$request_template" | sed -e "s/\"searchAfter\":.*,/\"searchAfter\":null,/g" > "$request_current"

while [ "$searchAfter" != "null" ]
do
	curl -s -XPOST "$URL" -d @"$request_current" > "$result_current"
	searchAfter=`cat "$result_current" | jq .nextPageSearchAfter`
	echo $searchAfter

	cat "$result_current" |  jq .domainsList[] >> "$all_results"

	wc -l "$all_results"

	cat "$request_template" | sed -e "s/\"searchAfter\":.*,/\"searchAfter\":$searchAfter,/g" > "$request_current"

done

--- 2nd Part -------- Filename: template.json

{
    "apiKey": "at_",
    "searchType": "current",
    "mode": "purchase",
    "punycode": true,
    "searchAfter": ,
    "basicSearchTerms": {
        "include": [
            "Google LLC"
        ]
    }
}

